<?php
namespace App\Services\StockTwits;
use Exception;
use App\StockTwits;
/**
 * Parses the StockTwits ticker API
 */

class ParseStocks {

    // The StockTwits ticker API URL
    private $url;

    // Used to store the JSON/string data
    private $data;

    // The ticker used
    private $ticker;

    // The current StockTwits ID
    private $id;

    // An array of messages containing four keys of data of:
    // message, stock_id, created_at, and the ticker name
    private $message = array();

    /**
     * Generate the URL
     * @param $ticker The ticker you want, i.e. AAPL
     * @param $id     The starting index, i.e. 41000000
     */
    public function __construct($ticker, $id) {
        // The StockTwits ticker API URL
        $this->url = 'https://api.stocktwits.com/api/2/streams/symbol/' . $ticker . '.json?since=' . $id;
        $this->ticker = $ticker;
    }

    /**
     * Get content and save it
     */
    public function load() {
        //read the json file contents
        $jsondata = file_get_contents($this->url);

//        $jsondata = '{"response":{"status":200},"symbol":{"id":686,"symbol":"AAPL","title":"Apple Inc."},"cursor":{"more":true,"since":41001431,"max":41000112},"messages":[{"id":41001431,"body":"$AAPL gaining last two days as broader markets and ETFs dropped was impressive. But $DIA needs to break this losing streak already.","created_at":"2015-08-07T22:08:25Z","user":{"id":515930,"username":"Madman0134","name":"Gerd Schroeder","avatar_url":"http://avatars.stocktwits.com/production/515930/thumb-1439160137.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/515930/thumb-1439160137.png","official":false,"identity":"User","classification":[],"join_date":"2015-05-11","followers":1,"following":60,"ideas":236,"like_count":98,"subscribers_count":0,"subscribed_to_count":0,"following_stocks":1,"location":"","bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":["Options"],"approach":"Momentum","holding_period":"Swing Trader","experience":"Novice"}},"source":{"id":1149,"title":"StockTwits for iOS","url":"http://www.stocktwits.com/mobile"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."},{"id":4979,"symbol":"DIA","title":"SPDR Dow Jones Industrial Average"}],"likes":{"total":1,"user_ids":[240770]}},{"id":41001393,"body":"$AAPL Carl Icahn tweet is coming? Last time he tweeted this went up like a rocket from 120s to 130s. Methinks it could happen anytime","created_at":"2015-08-07T22:06:43Z","user":{"id":430438,"username":"stans","name":"Stan Jones","avatar_url":"http://avatars.stocktwits.com/production/430438/thumb-1431525242.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/430438/thumb-1431525242.png","official":false,"identity":"User","classification":[],"join_date":"2014-11-30","followers":4,"following":28,"ideas":261,"like_count":35,"subscribers_count":0,"subscribed_to_count":0,"following_stocks":0,"location":"Boston","bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":["Options"],"approach":"Momentum","holding_period":"Swing Trader","experience":"Intermediate"}},"source":{"id":1,"title":"StockTwits","url":"http://stocktwits.com"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"conversation":{"parent_message_id":41001393,"in_reply_to_message_id":null,"parent":true,"replies":5},"likes":{"total":5,"user_ids":[401972,497656,254446,434405,503947]}},{"id":41001365,"body":"$AAPL Not calling anyone out, but I see the bear post &quot; Nothing in the pipeline&quot; , Really , do u not read? R U on the board of AAPL? No!","created_at":"2015-08-07T22:05:54Z","user":{"id":401972,"username":"Travis2264","name":"David vandersall","avatar_url":"http://avatars.stocktwits.com/production/401972/thumb-1432765198.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/401972/thumb-1432765198.png","official":false,"identity":"User","classification":[],"join_date":"2014-09-20","followers":36,"following":74,"ideas":1260,"like_count":2578,"subscribers_count":0,"subscribed_to_count":0,"following_stocks":1,"location":"palm springs ","bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":[],"approach":null,"holding_period":null,"experience":null}},"source":{"id":1,"title":"StockTwits","url":"http://stocktwits.com"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"likes":{"total":2,"user_ids":[434405,510978]}},{"id":41001331,"body":"$ASTI $AAPL Not news but good to know. Ascent Solar = Solar Powered Charger for Apple iPhone http://stks.co/g2vaV","created_at":"2015-08-07T22:04:52Z","user":{"id":528713,"username":"JuicyDrawing","name":"JuicyDrawing","avatar_url":"http://avatars.stocktwits.com/production/528713/thumb-1438984800.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/528713/thumb-1438984800.png","official":false,"identity":"User","classification":[],"join_date":"2015-06-04","followers":11,"following":1,"ideas":1018,"like_count":259,"subscribers_count":1,"subscribed_to_count":0,"following_stocks":4,"location":"","bio":"My opinions only. I&#39;m not a professional finance manager or even close. Do your own DD always. I may buy, sell, short or do nothing at all.","website_url":null,"trading_strategy":{"assets_frequently_traded":[],"approach":null,"holding_period":null,"experience":null}},"source":{"id":1,"title":"StockTwits","url":"http://stocktwits.com"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."},{"id":952,"symbol":"ASTI","title":"Ascent Solar Technologies, Inc."}],"conversation":{"parent_message_id":41001331,"in_reply_to_message_id":null,"parent":true,"replies":2},"links":[{"title":"Ascent Solar - Ascent Solar Launches Solar Powered Charger for Apple iPhone","url":"http://investors.ascentsolar.com/releasedetail.cfm?ReleaseID=680561","shortened_url":"http://stks.co/g2vaV","shortened_expanded_url":"investors.ascentsolar.com/r...","description":"Product will formally debut at the Intersolar Europe trade show next week THORNTON, Colo.--(BUSINESS WIRE)-- Ascent Solar Technologies, Inc. (NASDAQ:ASTI), a developer of state-of-the-art, flexible thin-film photovoltaic modules, announced today it has launched a charger for the Apple ® (NASDAQ:AAPL) iPhone ® * 4/4S smart phone featuring Ascent\'s ultra light CIGS technology.","image":"http://investors.ascentsolar.com/common/alerts/ASTI/default/logo.gif","created_at":"2015-08-07T22:04:56Z","video_url":null,"source":{"name":"Ascentsolar","website":"http://investors.ascentsolar.com"}}]},{"id":41001313,"body":"$AAPL we all know Monday will bounce. Ready to make money!","created_at":"2015-08-07T22:04:13Z","user":{"id":207585,"username":"Kala","name":"A.Villanueva III","avatar_url":"http://avatars.stocktwits.com/production/207585/thumb-1428611480.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/207585/thumb-1428611480.png","official":false,"identity":"User","classification":[],"join_date":"2013-01-15","followers":44,"following":58,"ideas":4090,"like_count":944,"subscribers_count":1,"subscribed_to_count":0,"following_stocks":3,"location":"Honolulu, Hawaii ","bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":["Options"],"approach":"Technical","holding_period":"Swing Trader","experience":"Novice"}},"source":{"id":2095,"title":"StockTwits For Android ","url":"http://www.stocktwits.com/mobile"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"likes":{"total":4,"user_ids":[509695,262124,434405,356973]}},{"id":41001102,"body":"@CalMustang @sierrashawn monthly service plan will then drop by $30-$40 so net effect is $0 :) $AAPL","created_at":"2015-08-07T21:57:12Z","user":{"id":252259,"username":"harryzimm2013","name":"Harry","avatar_url":"http://avatars.stocktwits.com/production/252259/thumb-1376917753.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/252259/thumb-1376917753.png","official":false,"identity":"User","classification":[],"join_date":"2013-08-14","followers":673,"following":39,"ideas":17337,"like_count":1405,"subscribers_count":17,"subscribed_to_count":7,"following_stocks":1,"location":"Malibu CA","bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":["Equities","Options"],"approach":"Momentum","holding_period":"Position Trader","experience":"Professional"}},"source":{"id":1149,"title":"StockTwits for iOS","url":"http://www.stocktwits.com/mobile"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"conversation":{"parent_message_id":41000041,"in_reply_to_message_id":41000852,"parent":false,"replies":25},"likes":{"total":1,"user_ids":[277365]}},{"id":41001101,"body":"@seeitmarket: New Post - Stock Market: Where&#39;s The Leadership? http://stks.co/q2elk by @MarkArbeter $SPY $QQQ $IWM $AAPL $BIIB $DIS $TSLA","created_at":"2015-08-07T21:57:12Z","user":{"id":315321,"username":"MarkArbeter","name":"Mark Arbeter CMT","avatar_url":"http://avatars.stocktwits.com/production/315321/thumb-1437947374.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/315321/thumb-1437947374.png","official":true,"identity":"Official","classification":["suggested","official"],"join_date":"2014-02-15","followers":15077,"following":52,"ideas":656,"like_count":242,"subscribers_count":22,"subscribed_to_count":0,"following_stocks":0,"location":"Bucks & Bedford County Pa.","bio":"Wall Street veteran. Former Chief Technical Strategist for major Wall Street Firm. CMT. Former head of MTA Admissions Committee. Shortlisted in 2013 as one of the best technicians for an equity research co. For newsletter info, arbetermark@gmail.com","website_url":null,"trading_strategy":{"assets_frequently_traded":["Equities","Options"],"approach":"Technical","holding_period":"Position Trader","experience":"Professional"}},"source":{"id":1,"title":"StockTwits","url":"http://stocktwits.com"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."},{"id":1075,"symbol":"BIIB","title":"Biogen Idec Inc."},{"id":4983,"symbol":"DIS","title":"Walt Disney Co."},{"id":5930,"symbol":"IWM","title":"iShares Russell 2000 Index"},{"id":7271,"symbol":"SPY","title":"SPDR S&P 500"},{"id":8660,"symbol":"TSLA","title":"Tesla Motors, Inc."},{"id":9581,"symbol":"QQQ","title":"PowerShares Nasdaq-100 QQQ"}],"links":[{"title":"The Stock Market: Where\'s The Leadership?","url":"http://www.seeitmarket.com/the-stock-market-wheres-the-leadership-stocks-aapl-dis-tsla-14641/","shortened_url":"http://stks.co/q2elk","shortened_expanded_url":"seeitmarket.com/the-stock-m...","description":"One by one, the large- to mega-cap leaders of this bull market have been taken behind the woodshed and shot. Names like Biogen Inc. (BIIB), Apple (AAPL) and Disney (DIS) are a few that come to mind. Former leaders like Baidu, Inc. (BIDU) and Green Mountain Coffee (GMCR) peaked in November 2014 and have been crushed.","image":"http://2us9vjrl2kf1np7bx397xl07.wpengine.netdna-cdn.com/wp-content/uploads/2015/05/bear-market-signal.jpg","created_at":"2015-08-07T21:57:22Z","video_url":null,"source":{"name":"Seeitmarket","website":"http://www.seeitmarket.com"}}],"likes":{"total":1,"user_ids":[165268]}},{"id":41001078,"body":"$AAPL 150$ in 6-12 months","created_at":"2015-08-07T21:56:16Z","user":{"id":198318,"username":"Dre1012","name":"Dre","avatar_url":"http://avatars.stocktwits.com/production/198318/thumb-1434225606.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/198318/thumb-1434225606.png","official":false,"identity":"User","classification":[],"join_date":"2012-12-01","followers":127,"following":176,"ideas":4097,"like_count":2647,"subscribers_count":0,"subscribed_to_count":0,"following_stocks":36,"location":"Montreal","bio":"Long-term investor","website_url":null,"trading_strategy":{"assets_frequently_traded":["Equities"],"approach":"Value","holding_period":"Long Term Investor","experience":"Professional"}},"source":{"id":1149,"title":"StockTwits for iOS","url":"http://www.stocktwits.com/mobile"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"likes":{"total":1,"user_ids":[445629]}},{"id":41001060,"body":"@CalMustang @sierrashawn then monthly service plan will drop by $30-$40 month. :) $AAPL","created_at":"2015-08-07T21:55:49Z","user":{"id":252259,"username":"harryzimm2013","name":"Harry","avatar_url":"http://avatars.stocktwits.com/production/252259/thumb-1376917753.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/252259/thumb-1376917753.png","official":false,"identity":"User","classification":[],"join_date":"2013-08-14","followers":673,"following":39,"ideas":17337,"like_count":1405,"subscribers_count":17,"subscribed_to_count":7,"following_stocks":1,"location":"Malibu CA","bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":["Equities","Options"],"approach":"Momentum","holding_period":"Position Trader","experience":"Professional"}},"source":{"id":1149,"title":"StockTwits for iOS","url":"http://www.stocktwits.com/mobile"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"conversation":{"parent_message_id":41000041,"in_reply_to_message_id":41000852,"parent":false,"replies":25}},{"id":41001000,"body":"$AAPL -- As a young lad I once made a battery out of a potato.","created_at":"2015-08-07T21:53:55Z","user":{"id":446693,"username":"Charles_Darwin","name":"Thomas H. Huxley","avatar_url":"http://avatars.stocktwits.com/production/446693/thumb-1420663385.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/446693/thumb-1420663385.png","official":false,"identity":"User","classification":[],"join_date":"2015-01-07","followers":75,"following":18,"ideas":2247,"like_count":466,"subscribers_count":0,"subscribed_to_count":0,"following_stocks":16,"location":"Galapagos Islands, EC","bio":"&quot;I realized technical analysis didn&#39;t work when I turned the charts upside down and didn&#39;t get a different answer.&quot; -- Warren Buffett","website_url":null,"trading_strategy":{"assets_frequently_traded":["Options"],"approach":"Fundamental","holding_period":"Long Term Investor","experience":"Professional"}},"source":{"id":1149,"title":"StockTwits for iOS","url":"http://www.stocktwits.com/mobile"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"conversation":{"parent_message_id":41001000,"in_reply_to_message_id":null,"parent":true,"replies":2},"likes":{"total":3,"user_ids":[157765,459673,260062]}},{"id":41000979,"body":"@PhilSinTX 5 years $aapl will have $500-$550b cash even after dividends paid. At only 2.5x cash = $1.2 trillion and values company at $0 LOL","created_at":"2015-08-07T21:53:18Z","user":{"id":252259,"username":"harryzimm2013","name":"Harry","avatar_url":"http://avatars.stocktwits.com/production/252259/thumb-1376917753.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/252259/thumb-1376917753.png","official":false,"identity":"User","classification":[],"join_date":"2013-08-14","followers":673,"following":39,"ideas":17337,"like_count":1405,"subscribers_count":17,"subscribed_to_count":7,"following_stocks":1,"location":"Malibu CA","bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":["Equities","Options"],"approach":"Momentum","holding_period":"Position Trader","experience":"Professional"}},"source":{"id":1149,"title":"StockTwits for iOS","url":"http://www.stocktwits.com/mobile"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"conversation":{"parent_message_id":40997150,"in_reply_to_message_id":40997150,"parent":false,"replies":7},"likes":{"total":1,"user_ids":[5353]}},{"id":41000931,"body":"@PhilSinTX $AAPL do you realize $aapl has $200b in cash today and will generate another $300-$350 billion in new cash over next 5 years.","created_at":"2015-08-07T21:51:31Z","user":{"id":252259,"username":"harryzimm2013","name":"Harry","avatar_url":"http://avatars.stocktwits.com/production/252259/thumb-1376917753.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/252259/thumb-1376917753.png","official":false,"identity":"User","classification":[],"join_date":"2013-08-14","followers":673,"following":39,"ideas":17337,"like_count":1405,"subscribers_count":17,"subscribed_to_count":7,"following_stocks":1,"location":"Malibu CA","bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":["Equities","Options"],"approach":"Momentum","holding_period":"Position Trader","experience":"Professional"}},"source":{"id":1149,"title":"StockTwits for iOS","url":"http://www.stocktwits.com/mobile"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"conversation":{"parent_message_id":40997150,"in_reply_to_message_id":40997150,"parent":false,"replies":7}},{"id":41000833,"body":"@Skevaboy it is all a lie. Will be another massive flop as the media will say. $AAPL","created_at":"2015-08-07T21:48:25Z","user":{"id":252259,"username":"harryzimm2013","name":"Harry","avatar_url":"http://avatars.stocktwits.com/production/252259/thumb-1376917753.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/252259/thumb-1376917753.png","official":false,"identity":"User","classification":[],"join_date":"2013-08-14","followers":673,"following":39,"ideas":17337,"like_count":1405,"subscribers_count":17,"subscribed_to_count":7,"following_stocks":1,"location":"Malibu CA","bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":["Equities","Options"],"approach":"Momentum","holding_period":"Position Trader","experience":"Professional"}},"source":{"id":1149,"title":"StockTwits for iOS","url":"http://www.stocktwits.com/mobile"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"conversation":{"parent_message_id":40999051,"in_reply_to_message_id":40999051,"parent":false,"replies":1}},{"id":41000808,"body":"Today&#39;s Most Active Options http://stks.co/c2Mhl $SPY $SPX $IWM $AAPL $QQQ","created_at":"2015-08-07T21:47:34Z","user":{"id":26965,"username":"Options_Edu","name":"Options Industry Council","avatar_url":"http://avatars.stocktwits.com/production/26965/thumb-1362590738.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/26965/thumb-1362590738.png","official":true,"identity":"Official","classification":["official"],"join_date":"2010-10-22","followers":7008,"following":28,"ideas":1426,"like_count":0,"subscribers_count":1,"subscribed_to_count":0,"following_stocks":0,"location":"Chicago, IL","bio":"Options Industry Council was created to educate investors and their financial advisors about the benefits and risks of exchange-traded equity options.","website_url":"http://www.optionseducation.org","trading_strategy":{"assets_frequently_traded":["Options"],"approach":null,"holding_period":null,"experience":"Professional"}},"source":{"id":1,"title":"StockTwits","url":"http://stocktwits.com"},"symbols":[{"id":679,"symbol":"SPX","title":"S&P 500 Index"},{"id":686,"symbol":"AAPL","title":"Apple Inc."},{"id":5930,"symbol":"IWM","title":"iShares Russell 2000 Index"},{"id":7271,"symbol":"SPY","title":"SPDR S&P 500"},{"id":9581,"symbol":"QQQ","title":"PowerShares Nasdaq-100 QQQ"}],"links":[{"title":"Today\'s Most Active Options","url":"http://www.optionseducation.org/tools/todays_most_active_options.html","shortened_url":"http://stks.co/c2Mhl","shortened_expanded_url":"optionseducation.org/tools/...","description":"OIC: The Options Industry Council","image":"http://www.optionseducation.org/content/dam/oic/images/logos/oic-logo.png","created_at":"2015-08-07T21:47:39Z","video_url":null,"source":{"name":"The Options Industry Council (OIC)","website":"http://www.optionseducation.org"}}]},{"id":41000802,"body":"@sierrashawn what are you talking about bro? $AAPL","created_at":"2015-08-07T21:47:26Z","user":{"id":252259,"username":"harryzimm2013","name":"Harry","avatar_url":"http://avatars.stocktwits.com/production/252259/thumb-1376917753.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/252259/thumb-1376917753.png","official":false,"identity":"User","classification":[],"join_date":"2013-08-14","followers":673,"following":39,"ideas":17337,"like_count":1405,"subscribers_count":17,"subscribed_to_count":7,"following_stocks":1,"location":"Malibu CA","bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":["Equities","Options"],"approach":"Momentum","holding_period":"Position Trader","experience":"Professional"}},"source":{"id":1149,"title":"StockTwits for iOS","url":"http://www.stocktwits.com/mobile"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"conversation":{"parent_message_id":41000041,"in_reply_to_message_id":41000041,"parent":false,"replies":25}},{"id":41000765,"body":"$AAPL the board of directors is incompetent to sit there and do nothing. They should be held accountable.","created_at":"2015-08-07T21:46:08Z","user":{"id":252259,"username":"harryzimm2013","name":"Harry","avatar_url":"http://avatars.stocktwits.com/production/252259/thumb-1376917753.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/252259/thumb-1376917753.png","official":false,"identity":"User","classification":[],"join_date":"2013-08-14","followers":673,"following":39,"ideas":17337,"like_count":1405,"subscribers_count":17,"subscribed_to_count":7,"following_stocks":1,"location":"Malibu CA","bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":["Equities","Options"],"approach":"Momentum","holding_period":"Position Trader","experience":"Professional"}},"source":{"id":1149,"title":"StockTwits for iOS","url":"http://www.stocktwits.com/mobile"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"conversation":{"parent_message_id":41000765,"in_reply_to_message_id":null,"parent":true,"replies":12},"likes":{"total":2,"user_ids":[377680,466023]}},{"id":41000727,"body":"@tms8700 he would be good to have on the board. He should get a board set. Get rid of Gore and Jung they are worthless. $AAPL","created_at":"2015-08-07T21:44:59Z","user":{"id":252259,"username":"harryzimm2013","name":"Harry","avatar_url":"http://avatars.stocktwits.com/production/252259/thumb-1376917753.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/252259/thumb-1376917753.png","official":false,"identity":"User","classification":[],"join_date":"2013-08-14","followers":673,"following":39,"ideas":17337,"like_count":1405,"subscribers_count":17,"subscribed_to_count":7,"following_stocks":1,"location":"Malibu CA","bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":["Equities","Options"],"approach":"Momentum","holding_period":"Position Trader","experience":"Professional"}},"source":{"id":1149,"title":"StockTwits for iOS","url":"http://www.stocktwits.com/mobile"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"conversation":{"parent_message_id":41000474,"in_reply_to_message_id":41000491,"parent":false,"replies":4},"likes":{"total":1,"user_ids":[543298]}},{"id":41000678,"body":"$cybr Followrs21of47 I covr+FrmOpn! 5my9Antihax $cybr 3% $cuda $feye $ftnt &amp; $pfpt $gwph $kyth $zts $aapl $blox $gpro $mm $rkus $sstk UpBit","created_at":"2015-08-07T21:43:38Z","user":{"id":153182,"username":"IPOTrader","name":"John Noland","avatar_url":"http://avatars.stocktwits.com/production/153182/thumb-1361659530.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/153182/thumb-1361659530.png","official":false,"identity":"User","classification":[],"join_date":"2012-04-30","followers":349,"following":0,"ideas":4197,"like_count":5,"subscribers_count":1,"subscribed_to_count":0,"following_stocks":3,"location":null,"bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":[],"approach":null,"holding_period":null,"experience":null}},"source":{"id":1,"title":"StockTwits","url":"http://stocktwits.com"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."},{"id":2051,"symbol":"GPRO","title":"GoPro"},{"id":7958,"symbol":"FTNT","title":"Fortinet Inc."},{"id":8946,"symbol":"BLOX","title":"mBlox"},{"id":9016,"symbol":"PFPT","title":"Proofpoint"},{"id":11221,"symbol":"MM","title":"Millennial Media, Inc."},{"id":11327,"symbol":"RKUS","title":"Ruckus"},{"id":11331,"symbol":"SSTK","title":"Shutterstock, Inc."},{"id":11393,"symbol":"ZTS","title":"Zoetis Inc."},{"id":11422,"symbol":"KYTH","title":"Kythera Biopharmaceuticals Inc."},{"id":11571,"symbol":"FEYE","title":"FireEye Inc"},{"id":11580,"symbol":"CUDA","title":"Barracuda Networks"},{"id":11601,"symbol":"GWPH","title":"GW Pharmaceuticals plc"},{"id":12110,"symbol":"CYBR","title":"Cyber-Ark Software"}]},{"id":41000630,"body":"$AAPL We go through this every quarter, &quot; Yeah , they beat estimates but.............BS!!!!!","created_at":"2015-08-07T21:41:58Z","user":{"id":401972,"username":"Travis2264","name":"David vandersall","avatar_url":"http://avatars.stocktwits.com/production/401972/thumb-1432765198.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/401972/thumb-1432765198.png","official":false,"identity":"User","classification":[],"join_date":"2014-09-20","followers":36,"following":74,"ideas":1260,"like_count":2578,"subscribers_count":0,"subscribed_to_count":0,"following_stocks":1,"location":"palm springs ","bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":[],"approach":null,"holding_period":null,"experience":null}},"source":{"id":1,"title":"StockTwits","url":"http://stocktwits.com"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"conversation":{"parent_message_id":41000630,"in_reply_to_message_id":null,"parent":true,"replies":2},"likes":{"total":5,"user_ids":[543298,551468,471068,271586,427017]}},{"id":41000542,"body":"$AAPL Cook should put out a $25 billion tender offer at $130 and get rid of all the sellers once and for all.","created_at":"2015-08-07T21:39:16Z","user":{"id":252259,"username":"harryzimm2013","name":"Harry","avatar_url":"http://avatars.stocktwits.com/production/252259/thumb-1376917753.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/252259/thumb-1376917753.png","official":false,"identity":"User","classification":[],"join_date":"2013-08-14","followers":673,"following":39,"ideas":17337,"like_count":1405,"subscribers_count":17,"subscribed_to_count":7,"following_stocks":1,"location":"Malibu CA","bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":["Equities","Options"],"approach":"Momentum","holding_period":"Position Trader","experience":"Professional"}},"source":{"id":1149,"title":"StockTwits for iOS","url":"http://www.stocktwits.com/mobile"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"likes":{"total":6,"user_ids":[543298,401972,454673,551468,546049,122143]}},{"id":41000474,"body":"$AAPL there needs to be radical changes made with the board of directors. This is unacceptable. Need someone with financial background.","created_at":"2015-08-07T21:37:05Z","user":{"id":252259,"username":"harryzimm2013","name":"Harry","avatar_url":"http://avatars.stocktwits.com/production/252259/thumb-1376917753.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/252259/thumb-1376917753.png","official":false,"identity":"User","classification":[],"join_date":"2013-08-14","followers":673,"following":39,"ideas":17337,"like_count":1405,"subscribers_count":17,"subscribed_to_count":7,"following_stocks":1,"location":"Malibu CA","bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":["Equities","Options"],"approach":"Momentum","holding_period":"Position Trader","experience":"Professional"}},"source":{"id":1149,"title":"StockTwits for iOS","url":"http://www.stocktwits.com/mobile"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"conversation":{"parent_message_id":41000474,"in_reply_to_message_id":null,"parent":true,"replies":4},"likes":{"total":1,"user_ids":[456275]}},{"id":41000454,"body":"$MNKD yall remember when Apple computers sucked? Now imagine if u jumped ship on $AAPL in 2000. Long n strong like my dingdong","created_at":"2015-08-07T21:36:28Z","user":{"id":361339,"username":"kaboom","name":"Justin glick","avatar_url":"http://avatars.stocktwits.com/production/361339/thumb-1409691798.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/361339/thumb-1409691798.png","official":false,"identity":"User","classification":[],"join_date":"2014-06-05","followers":12,"following":2,"ideas":704,"like_count":67,"subscribers_count":1,"subscribed_to_count":0,"following_stocks":1,"location":"","bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":[],"approach":null,"holding_period":null,"experience":null}},"source":{"id":1149,"title":"StockTwits for iOS","url":"http://www.stocktwits.com/mobile"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."},{"id":2694,"symbol":"MNKD","title":"MannKind Corp."}],"conversation":{"parent_message_id":41000454,"in_reply_to_message_id":null,"parent":true,"replies":19},"likes":{"total":20,"user_ids":[491553,401972,260206,546867,467925,226850,434405,384019,266127,420996,385803,433820,427017,343524,478856,362564,451184,154622,318876,221972]}},{"id":41000338,"body":"$AAPL : Watchlist for next week $AAPL , $DIS , $AXP , $WMT","created_at":"2015-08-07T21:33:54Z","user":{"id":250705,"username":"vik_canadian","name":"vik","avatar_url":"http://avatars.stocktwits.com/production/250705/thumb-1439795610.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/250705/thumb-1439795610.png","official":false,"identity":"User","classification":[],"join_date":"2013-08-08","followers":180,"following":25,"ideas":6682,"like_count":833,"subscribers_count":0,"subscribed_to_count":0,"following_stocks":9,"location":"Los Angles,CA,USA","bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":["Equities","Options"],"approach":"Fundamental","holding_period":"Position Trader","experience":"Professional"}},"source":{"id":1149,"title":"StockTwits for iOS","url":"http://www.stocktwits.com/mobile"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."},{"id":4423,"symbol":"AXP","title":"American Express Company"},{"id":4983,"symbol":"DIS","title":"Walt Disney Co."},{"id":7745,"symbol":"WMT","title":"Walmart Stores Inc."}],"likes":{"total":1,"user_ids":[509695]}},{"id":41000333,"body":"$AAPL The Death knell on AAPL is greatly exaggerated!!!","created_at":"2015-08-07T21:33:48Z","user":{"id":401972,"username":"Travis2264","name":"David vandersall","avatar_url":"http://avatars.stocktwits.com/production/401972/thumb-1432765198.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/401972/thumb-1432765198.png","official":false,"identity":"User","classification":[],"join_date":"2014-09-20","followers":36,"following":74,"ideas":1260,"like_count":2578,"subscribers_count":0,"subscribed_to_count":0,"following_stocks":1,"location":"palm springs ","bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":[],"approach":null,"holding_period":null,"experience":null}},"source":{"id":1,"title":"StockTwits","url":"http://stocktwits.com"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"likes":{"total":4,"user_ids":[139611,208367,427017,504871]}},{"id":41000316,"body":"$AAPL Guy self-diagnoses heart w/ Watch, glimpse of future: http://stks.co/e2MqM","created_at":"2015-08-07T21:33:15Z","user":{"id":458660,"username":"DzVestr","name":"DL Haze","avatar_url":"http://avatars.stocktwits.com/production/458660/thumb-1440793411.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/458660/thumb-1440793411.png","official":false,"identity":"User","classification":[],"join_date":"2015-02-02","followers":16,"following":130,"ideas":1280,"like_count":877,"subscribers_count":0,"subscribed_to_count":0,"following_stocks":13,"location":"","bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":["Equities"],"approach":"Fundamental","holding_period":"Long Term Investor","experience":"Novice"}},"source":{"id":1,"title":"StockTwits","url":"http://stocktwits.com"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"conversation":{"parent_message_id":41000316,"in_reply_to_message_id":null,"parent":true,"replies":6},"links":[{"title":"Heart patient: Apple Watch got me in and out of hospital fast","url":"http://medcitynews.com/2015/07/heart-patient-apple-watch-got-me-in-and-out-of-hospital-fast/","shortened_url":"http://stks.co/e2MqM","shortened_expanded_url":"medcitynews.com/2015/07/hea...","description":"A few days ago, we reported on an incident, related by digital health champion Dr. Eric Topol, of a patient self-diagnosing a serious heart ailment based on Apple Watch data. We have since spoken to that patient, and heard a fascinating story.","image":"http://medcitynews.com/wp-content/uploads/2015/07/Gigi-and-Ken-Robson.jpg","created_at":"2015-08-07T21:33:19Z","video_url":null,"source":{"name":"MedCity News","website":"http://medcitynews.com"}}],"likes":{"total":4,"user_ids":[277365,549962,558937,488052]}},{"id":41000304,"body":"$AAPL The last time this was as oversold as per RSI, was JUL 2013, basically the bottom of the SEP 2012 High !","created_at":"2015-08-07T21:33:03Z","user":{"id":348491,"username":"tms8700","name":"Tms","avatar_url":"http://avatars.stocktwits.com/images/default_avatar_thumb.jpg","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/images/default_avatar_thumb.jpg","official":false,"identity":"User","classification":[],"join_date":"2014-04-29","followers":13,"following":3,"ideas":1585,"like_count":147,"subscribers_count":1,"subscribed_to_count":0,"following_stocks":0,"location":"","bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":[],"approach":null,"holding_period":null,"experience":null}},"source":{"id":1,"title":"StockTwits","url":"http://stocktwits.com"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"likes":{"total":1,"user_ids":[434405]}},{"id":41000302,"body":"&quot;@tndsh1975 &quot;@randith7368 $aapl Apple Stock Forecast and Quarterly Report Analysis \n\nhttp://stks.co/f2voB&quot;&quot;","created_at":"2015-08-07T21:33:01Z","user":{"id":485953,"username":"tndsh1975","name":"TAndisho","avatar_url":"http://avatars.stocktwits.com/images/default_avatar_thumb.jpg","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/images/default_avatar_thumb.jpg","official":false,"identity":"User","classification":[],"join_date":"2015-03-16","followers":14,"following":62,"ideas":1850,"like_count":19,"subscribers_count":1,"subscribed_to_count":1,"following_stocks":0,"location":null,"bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":[],"approach":null,"holding_period":null,"experience":null}},"source":{"id":1149,"title":"StockTwits for iOS","url":"http://www.stocktwits.com/mobile"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"links":[{"title":"Apple Stock Forecast and Quarterly Report Analysis (AAPL)","url":"http://iknowfirst.com/apple-quarterly-report-analysis-and-future-forecast-aapl","shortened_url":"http://stks.co/f2voB","shortened_expanded_url":"iknowfirst.com/apple-quarte...","description":"On July 15 th, the I Know First research team posted a bullish long-term evaluation of Apple stock whilst analysing their Chinese market, Apple Watch, Apple TV and operating profits. Since then, Apple Inc. have released their latest quarterly results which reported revenue growth of 33% reaching $49.6bn and profits of $10.7bn.","image":"http://iknowfirst.com/wp-content/uploads/2015/07/apple-logo.jpg","created_at":"2015-08-07T21:33:06Z","video_url":null,"source":{"name":"Stock Forecast Based On a Predictive Algorithm | I Know First |","website":"http://iknowfirst.com"}}]},{"id":41000295,"body":"$AAPL buy the dips and sell the rips. Next week the big accounts will accumulate until it hits about 123 or 124 on the month.","created_at":"2015-08-07T21:32:47Z","user":{"id":440380,"username":"Notcounterfeit","name":"John Pel","avatar_url":"http://avatars.stocktwits.com/production/440380/thumb-1419295972.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/440380/thumb-1419295972.png","official":false,"identity":"User","classification":[],"join_date":"2014-12-22","followers":43,"following":316,"ideas":960,"like_count":728,"subscribers_count":2,"subscribed_to_count":0,"following_stocks":15,"location":"New Jersey","bio":"Worked hard all my life. Now looking to make it by investing. Thank you to the honest, smart, and helpful people here. Be rewarded in your portfolio. We all should be here to help and point out unethical behavior. IMO Control loss best advise given.","website_url":null,"trading_strategy":{"assets_frequently_traded":["Equities"],"approach":"Growth","holding_period":"Swing Trader","experience":"Novice"}},"source":{"id":1,"title":"StockTwits","url":"http://stocktwits.com"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"likes":{"total":2,"user_ids":[434405,535975]}},{"id":41000293,"body":"$AAPL is my best put sale pick this week - http://stks.co/p2egg $QQQ","created_at":"2015-08-07T21:32:45Z","user":{"id":404093,"username":"baerrus","name":"Baerrus","avatar_url":"http://avatars.stocktwits.com/production/404093/thumb-1411622141.png","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/production/404093/thumb-1411622141.png","official":false,"identity":"User","classification":[],"join_date":"2014-09-25","followers":18,"following":23,"ideas":274,"like_count":59,"subscribers_count":0,"subscribed_to_count":0,"following_stocks":26,"location":"California","bio":"Self directed investor for over a decade. Experienced options trader. I share my option trading tips free on http://optionsforum.net","website_url":"http://optionsforum.net","trading_strategy":{"assets_frequently_traded":[],"approach":null,"holding_period":null,"experience":null}},"source":{"id":1,"title":"StockTwits","url":"http://stocktwits.com"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."},{"id":9581,"symbol":"QQQ","title":"PowerShares Nasdaq-100 QQQ"}],"links":[{"title":"Selling Puts on AAPL","url":"http://optionsforum.net/topic/254/selling-puts-on-aapl","shortened_url":"http://stks.co/p2egg","shortened_expanded_url":"optionsforum.net/topic/254/...","description":"Selling Puts on AAPL Volatility seems to be returning to the Market. AAPL has been a stalwart singlehandedly supporting Nasdaq for year and a half now. But the luster is coming off and the sentiment is turning quickly on AAPL. However weakness should not deter dedicated options traders.","image":"https://www.tradingview.com/x/ZYeCr6ZZ/","created_at":"2015-08-07T21:32:49Z","video_url":null,"source":{"name":"The Options Forum","website":"http://optionsforum.net"}}]},{"id":41000112,"body":"$AAPL price target next week as long as Murray china Greece Ebola the big crash or Russia or great er","created_at":"2015-08-07T21:27:45Z","user":{"id":497656,"username":"charlesgrover96","name":"Makncash01","avatar_url":"http://avatars.stocktwits.com/images/default_avatar_thumb.jpg","avatar_url_ssl":"https://s3.amazonaws.com/st-avatars/images/default_avatar_thumb.jpg","official":false,"identity":"User","classification":[],"join_date":"2015-04-08","followers":6,"following":61,"ideas":809,"like_count":842,"subscribers_count":2,"subscribed_to_count":0,"following_stocks":1,"location":"","bio":null,"website_url":null,"trading_strategy":{"assets_frequently_traded":[],"approach":null,"holding_period":null,"experience":null}},"source":{"id":1,"title":"StockTwits","url":"http://stocktwits.com"},"symbols":[{"id":686,"symbol":"AAPL","title":"Apple Inc."}],"conversation":{"parent_message_id":41000112,"in_reply_to_message_id":null,"parent":true,"replies":3},"likes":{"total":3,"user_ids":[440380,543298,445629]}}]}';

        //convert json object to php associative array
        $this->data = json_decode($jsondata, true);

    }

    // Parse each message and save them to a custom data structure
    public function parseMessages() {
        if(empty($this->data['messages'])) {
            throw new Exception('No messages found');
        }

        foreach($this->data['messages'] as $index => $item) {
            $stocks = new StockTwits;
            $this->message[$index]['body'] = $item['body'];
            $this->message[$index]['stock_id'] = $item['id'];
            $this->message[$index]['created_at'] = $item['created_at'];
            $this->message[$index]['symbol'] = $this->ticker;

            $stocks->body = $item['body'];
            $stocks->stock_id = $item['id'];
            $stocks->stock_created_at = $item['created_at'];
            $stocks->symbol = $this->ticker;
            $stocks->save();
        }
    }

    // Get max ID
    public function getMaxID() {
        return $this->message[0]['stock_id'];
    }

    public function getData() {
        return $this->message;
    }

    public function getURL() {
        return $this->url;
    }

    public function getBody(){
        return $this->body;
    }

    public function getStockID(){
        return $this->stock_id;
    }

    public function getCreatedAt(){
        return $this->created_at;
    }
    public function getSymbol(){
        return $this->symbol;
    }
}